<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[树莓派+HomeBridge实现HomeKit控制智能家居]]></title>
    <url>%2F2019%2F09%2F25%2F%E6%A0%91%E8%8E%93%E6%B4%BE%2BHomeBridge%E5%AE%9E%E7%8E%B0HomeKit%E6%8E%A7%E5%88%B6%E6%99%BA%E8%83%BD%E5%AE%B6%E5%B1%85%2F</url>
    <content type="text"><![CDATA[米家app发展的很快，短短几年，已经日趋完善，得益于其高性价比，用户也越来越多，反观HomeKit在国内的表现，也仅仅是同“电视.app“一样，躺在每个ios用户的手机里。后来，在GitHub上开源了一个HomeBridge项目，通过树莓派做桥接，实现Siri控制米家智能设备。 ##一、需要准备的东西 支持 iOS10 的苹果设备（ iPhone 5 以上、 iPad mini 2 以上、 iPod 第六代以上） 小米多功能网关二代（ 注意：一定要二代！） 任意一个或多个支持 HomeKit 的设备：小米智能插座 ZigBee 版、小米人体传感器、小米门窗传感器、小米温湿度传感器、Yeelight智能灯泡、 Aqara墙壁开关等 树莓派 Raspberry Pi 3B+ （包含读卡器 &amp; 8 Gb 以上 TF 内存卡一张） Mac Book一台（当然，win也可以） 树莓派3B+ ##二、GitHub项目地址 HomeBridge homebridge-mi-aqara ##三、开始吧 关于树莓派的安装和打开ssh可以先移步系统烧录和打开ssh； 跟新gcc（可以使用pi用户也可以使用root用户，使用pi用户涉及权限问题请加sudo）sudo apt-get install gcc 接下来依次安装，如果你发现速度很慢，你可能需要更改中国软件源，参考文章：Raspbian 中国软件源,阿里云各个地方速度都不错。a. 安装nodejs：sudo apt-get updatecurl -sL https://deb.nodesource.com/setup_6.x | sudo -E bash -sudo apt-get install -y nodejssudo apt-get install -y build-essentialb. 安装avahi：sudo apt-get install libavahi-compat-libdnssd-devc. 安装HomeBridge：sudo npm install -g --unsafe-perm homebridged. 安装homebridge-aqara：sudo npm install -g homebridge-aqara安装部分完成！ 新建和配置config.json文件返回主目录→创建” .homebridge “文件夹→进入” config.json “文件） 123cd ~ mkdir .homebridgevim .homebridge/config.json 复制以下代码稍作修改： 123456789101112131415161718192021222324&#123; &quot;bridge&quot;: &#123; &quot;name&quot;: &quot;Homebridge&quot;, &quot;username&quot;: &quot;CC:22:3D:E3:CE:30&quot;, &quot;port&quot;: 51826, &quot;pin&quot;: &quot;031-45-154&quot; &#125;, &quot;platforms&quot;: [&#123; &quot;platform&quot;: &quot;AqaraPlatform&quot;, &quot;sid&quot;: [&quot;【（密码A）网关MAC地址，去掉冒号，全部小写】&quot;], &quot;password&quot;: [&quot;【（密码B）网关局域网密码】&quot;] &#125;]&#125; 其中 name 是你在 iOS 家庭 App 上可以看到的桥接器的名字，建议就叫 Homebridge，username 需要是类似 MAC 的格式，是可以随意填写，只要符合格式，建议不需要更改了。port 随意，确保不要被占用。pin 随意，为密码，需要是 8 位数字，格式为 xxx-xx-xxx，比如 123-45-678。下面的 platform 也是无所谓修改不修改，关键是sid和password，这就需要在手机上操作了。在手机上打开米家 App，点击你的网关，右上角三个 ···，并狂按底部空白区域，直到出现局域网通信协议和网管信息为止。点击局域网通信协议，打开，并刷新一个密码，改为全部小写，（安卓手机刷出来是小写），记录这段文字（密码 A ）。点击网关信息，找到 mac: 后的文字，如本截图中的 28:6C:07:85:B3:0E，去掉 : 并全部改为小写，也记录这段文字（密码 B ），如本截图中的文字处理后的结果就是 f0b429cc6168。第一个密码 A 就是你的 sid，第二个密码 B 就是 password。如果你有多个网关用逗号链接，比如 cb30a01c1bcc4b3c, dc41b12d2cdd5c4d, password 同理。在刚刚树莓派编辑的 config.json 输入上面获得的密码，保存退出。（vim的使用自行Google） 运行homebridge直接在命令行输入homebridge就能运行；有时出现错误会自动关闭，错误原因有很多，一般就是端口占用，或者mac地址和密码填写错误，仔细检查，如果不行的话，清除缓存，删除连接信息重新运行homebridge：操作方法a. 结束HomeBridge进程，如下：pkill -9 homebridgeb. 进入config.json所在的文件夹，例如：cd /root/.homebridgec. 删除文件夹下persist文件夹，例如：rm -rf persistd. 重启Homebridge进程，例如：homebridge掏出iPhone，打开家庭app，点击添加配件，扫描二维码或者手动输入你设置的八位密码就可以配对成功，操作完成。 最后的最后，你会发现，HomeBridge 停止运行了。我们不可能在电脑上挂着终端使树莓派一直运行这个服务，因此还有最后一步，把 HomeBridge 服务加入到树莓派的系统服务里。事实上, 树莓派文档 Scheduling tasks with Cron 给出的方法是最简单并且方便以后配置别的程序。先安装 cronsudo apt-get install gnome-schedule然后配置 cron.crontab -e在最下方添加@reboot homebridge &amp;即可完成开机启动 homebridge 的配置。现在，你可以重启一下树莓派，运行ps -ef | grep homebridge看看 HomeBridge 服务是否正常运行. 最后来感叹一下apple的生态系统，当我成功配置后，我能够在iPhone、ipad、mac、甚至是Apple Watch上控制小米家居，实在激动。 ##参考：树莓派进阶（一）：借助树莓派与 HomeBridge，从米家到 HomeKit从米家到 HomeKit，你只需要一个树莓派HomeBridge教程]]></content>
      <tags>
        <tag>树莓派</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[通过Hexo + Github 搭建博客]]></title>
    <url>%2F2019%2F05%2F25%2F%E9%80%9A%E8%BF%87Hexo-Github-%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2%2F</url>
    <content type="text"><![CDATA[最近学习压力很大，想起了这个被搁置一年的博客计划，正好看到了Hexo搭建的萤火之森页面，真的很漂亮，于是决定动手自己搭建一个。这篇文章正好记录一下搭建过程中遇到的问题，方便以后学习。 遇到的问题1. Github密匙只读2. hexo s 显示4000端口不能用解决方法：在Blog的根目录下，修改_config.ynl文件，在最后加上：1234server: port: 4001 #注意port前有Tab键 冒号后有空格 compress: true header: true 花费的时间总的算下来，总共花了我四个小时左右的时间来搭建这个博客，当然，这仅仅是搭建了基础的框架，后期还需要大量的时间来美化，不过鉴于最近考试太忙，估计得延期一段时间了。 为什么要需要这个博客？一年前，我用阿里云镜像一键搭建了基于Wordpress的个人博客，但是由于拖更，导致兴趣越来越少，最后也就不了了之了。从这段历程中，我感受到了，不是自己努力来的结果自己真是不懂得珍惜，这一个花费我一晚上心血建立的Blog，我可要好好监督自己，不要荒废了。其实，挺羡慕那些能在各种论坛分享自己知识的人，帮助别人的同时也能留下自己的足迹，最重要的是，在这个过程中，能找到归属感与成就感，这就是分享的意义吧。很大一部分人，写的都是技术博客，但是我知道自己现在能力有限，输出不了太多的干货，所以，现在这个阶段，更多的是记录一些学习笔记，当然，我也想穿插一些自己的心里话，写一下每个阶段的感悟。 搭建过程让我学到了什么搭建过程虽然烦琐，但我确乐在其中，兴趣是最好的老师，在搭建过程中，我看到了很多感兴趣的技术，比如GitHub的代码托管（很早以前我就注册了GitHub账号，但是一直没有项目来练习），比如Node.js，看到漂亮的网页，不眠不免对前端心生向往，再比如最近一直在学习的Linux命令行，现我已经迫不及待想要用shell自己写一个一键部署脚本了。 给自己立下Flag我的脑海里会迸发出很多新计划，但是最后很多都是不了了之，因为没有去实现，所以，在这里，我要给自己定几个目标： 每个月至少来更新一篇博客，不管是什么类型的。 尽快掌握MarkDown与法，写出排版漂亮的文章。 将我的小站好好维护下去，做一些优化。 开始GitHub的学习 关于我我觉得我很有想法，但是想到和做到之间，有一块透明的玻璃挡在我的面前，它看不见，但是它真实存在，而现在我要做的，就是想办法用行动突破它！在脑海里的话语，写在纸面上就是另外一番模样，说白了，我需要练习自己的写作能力了，多年后，看到这青涩的文字，嘴角应该会有一丝微笑吧。]]></content>
      <categories>
        <category>思考</category>
      </categories>
      <tags>
        <tag>感悟</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hello World]]></title>
    <url>%2F2019%2F05%2F25%2Fhello-world%2F</url>
    <content type="text"><![CDATA[Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new "My New Post" More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment]]></content>
  </entry>
  <entry>
    <title><![CDATA[用Mweb发布Hexo博客]]></title>
    <url>%2F2019%2F04%2F10%2Ftest%2F</url>
    <content type="text"><![CDATA[测试一下图床功能]]></content>
      <categories>
        <category>测试</category>
      </categories>
      <tags>
        <tag>test</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[小米路由器青春版刷Padavan固件]]></title>
    <url>%2F2019%2F01%2F26%2F%E5%B0%8F%E7%B1%B3%E8%B7%AF%E7%94%B1%E5%99%A8%E9%9D%92%E6%98%A5%E7%89%88%E5%88%B7Padavan%E5%9B%BA%E4%BB%B6%2F</url>
    <content type="text"><![CDATA[刷机是一种乐趣，大学宿舍晚上断电，正好手上有一个小米路由器青春版，USB充电宝供电，巴掌大小，放在宿舍简直合适不过了。最最最厉害的是可以刷潘多拉固件，简直不要太好！（这篇文章是以前Wordpress上写的，后来荒废了，但是这篇文章留在了MWeb的文件夹里，感谢MarkDown！） 准备： 小米路由器青春版 *1 网线 *1 电脑(Mac 或 Windows) *1 刷机所需的固件，软件（Putty和WINSCP自行百度下载） 基本思路： 首先确保路由器ROM版本为2.0，如果不是，降级到2.0或刷入开发版miwifi_r1cl_all_59371_2.1.26.bin版本(点击下载这个开发版） 修改网页地址的方式来篡改web管理密码和root密码 使用telnet命令进去备份各个分区(非必须) 刷入breed 刷入固件（潘多拉或梅林） 步骤： 小米路由器青春版是没有官方通道开启ssh的，其它版本路由器可以在miwifi开放平台查看。在网友的帖子里，我们可以直接修改路由器的请求地址的特定参数，改变系统参数，从而开启ssh。 首先确保路由器ROM版本为2.0，如果不是，降级到2.0或刷入开发版miwifi_r1cl_all_59371_2.1.26.bin版本(点击下载这个开发版）降级方法：由官方的路由管理界面，上传本ROM包，自动升级即可 在浏览器地址栏输入192.168.31.1，输入管理员密码（如果忘记了的话按住路由器的reset键10s以上重置系统，设置账户密码再做上面的操作），地址栏会多出一部分参数，比如我的是： 1http://192.168.31.1/cgi-bin/luci/;stok=6bb3936a88b4df625ded00d17be3911a/web/home#router 更改管理员密码和root密码将上面的地址中的 /web/home#router 改为 /api/xqsystem/set_name_password?oldPwd=旧密码&amp;newPwd=新密码 ，然后确定，看网页的返回值，如果是{“code”:0}就表示修改成功，可以接着下一步。 把 /web/home#router 改为 /api/xqnetwork/set_wifi_ap?ssid=xiaomi&amp;encryption=NONE&amp;enctype=NONE&amp;channel=1%3B%2Fusr%2Fsbin%2Ftelnetd ，然后查看返回的JSON数据 {“msg”:”未能连接到指定WiFi(Probe timeout)”,”code”:1616} ，就可以用telnet方式登录路由器。 用telnet方式登录路由器下载一个Putty 。然后打开选填以下参数，连接类型：telnet;主机名称：192.168.31.1.点击连接。可以看到看到login，账户输入root，密码则为以上第二步中修改的新密码。然后依次执行下面的三条指令： 123sed -i &quot;:x;N;s/if \[.*\; then\n.*return 0\n.*fi/#tb/;b x&quot; /etc/init.d/dropbear /etc/init.d/dropbear start nvram set ssh_en=1; nvram commit 此时我们已经开放ssh，可以用ssh方式登录路由器了。 刷入breedWINSCP 选择SCP协议 复制breed.bin 到/tmp输入以下命令刷入，刷入后，机器会自动重启： 1mtd -r write /tmp/breed.bin Bootloader 进入breed控制台先给路由器断电，再按住路由器reset键，再给路由器送电，等到路由器灯闪的时候，松开reset键，用一根网线将路由器的WAN口和电脑相连，在电脑上在浏览器中输入192.168.1.1，进入breed控制台了。 刷入固件可供选择的固件还是很多的，在这里我找了一个padavan,这固件是从Padavan固件源码搬运源码汉化后编译出来的。选择MI-NANO_3.4.3.9-099.trx这个版本，青春版专供直接在控制台选择上固件，然后点击更新，等待路由器自动重启，万事大吉！ 修改灯光颜色开机灯颜色蓝色橙色混合使用下面的命令关闭橙色灯变成纯正蓝色 1mtk_gpio -d 44 0 管理路由器刷入成功后，默认创建了名字为PCDN的无线网络，默认的密码为1234567890后台网址为192.168.123.1，账号密码都为admin。（登录后可自行修改）另外，可以配置ss，开启广告屏蔽插件等操做。 参考文章：小米路由器青春版刷Padavan固件小米路由器青春版刷潘多拉、华硕固件小米路由器青春版开启SSH刷入Padavan固件小米路由器青春版刷Padavan以及修改灯光颜色]]></content>
      <categories>
        <category>刷机</category>
      </categories>
      <tags>
        <tag>路由器</tag>
      </tags>
  </entry>
</search>
